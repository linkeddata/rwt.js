var http = require('http');
var url = require('url');
var crypto = require('crypto');

baseurl = (function() {
    //var key = crypto.randomBytes(2).toString('hex'),
    var key = '1234',
        base = 'http://test'+key+'.data.fm';
    return function(path) { return url.parse(base + path); }
})();

exports.req = function(meth, path, data, callback) {
    var s = 0, d = '', h, q = baseurl(path);
    q.method = meth;
    var q = http.request(q, function(r) {
        s = r.statusCode;
        h = r.headers;
    }).on('data', function(s) {
        d += s;
    }).on('error', function(e) {
        console.log("req.error: " + e.message);
    }).on('close', function() {
        callback(s, h, d);
    });
    if (data)
        q.write(data);
    q.end();
};

